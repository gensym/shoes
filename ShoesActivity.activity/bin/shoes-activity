#!/bin/sh
# Launches a Shoes environment with Sugar hooks.
# Based off of the etoys-activity Etoys launcher script by Bert Frudenberg.

echo "$0" "$@"
echo

# arguments are unordered, have to loop
args=""
while [ -n "$2" ] ; do
    case "$1" in
      	-b | --bundle-id)   bundle_id="$2"   ;;
      	-a | --activity-id) activity_id="$2" ;;
      	-o | --object-id)   object_id="$2"   ;;
	-u | --uri)         uri="$2"         ;;
	*) echo unknown argument $1 $2 ;;
    esac
    shift;shift
done

# really need bundle id and activity id
if [ -z "$bundle_id" -o -z "$activity_id" ] ; then
  echo ERROR: bundle-id and activity-id arguments required
  echo Aborting
  exit 1
fi

bundle_path=$SUGAR_BUNDLE_PATH

# some debug output
echo launching $bundle_id instance $activity_id
[ -n "$object_id"   ] && echo with journal obj $object_id
[ -n "$uri"         ] && echo loading uri $uri
echo

# sanitize
[ -z "$SUGAR_PROFILE" ] && SUGAR_PROFILE=default
[ -z "$SUGAR_ACTIVITY_ROOT" ] && SUGAR_ACTIVITY_ROOT="$HOME/.sugar/$SUGAR_PROFILE/shoes"

echo SUGAR_ACTIVITY_ROOT=$SUGAR_ACTIVITY_ROOT
echo

# ensure DBus errors catch our attention
export DBUS_FATAL_WARNINGS=1

# run Shoes
exec bin/shoes/shoes \
     --sugar-bundle-id $bundle_id \
     --sugar-activity-id $activity_id
